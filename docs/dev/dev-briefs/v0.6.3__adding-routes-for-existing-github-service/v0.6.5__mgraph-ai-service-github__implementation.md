# MGraph-AI Service GitHub - Implementation Brief 

**version**: v0.6.5

## Document Purpose

This brief provides complete implementation guidance for extending the MGraph-AI__Service__GitHub FastAPI service to expose GitHub API capabilities (Secrets, Actions, Repos) through a stateless, encrypted-PAT architecture.

**Target Audience**: LLM agents or developers implementing the service layer, routes, and schemas.

**Reference Codebase**: `the-cyber-boardroom/MGraph-AI__Service__GitHub` (branch: `dev`)

---

## 1. Executive Summary

### 1.1 Project Context

The MGraph-AI Service GitHub is a stateless microservice that proxies GitHub API operations. It holds no secrets server-side—clients provide encrypted GitHub PATs that are decrypted on-the-fly using NaCl keys that exist only in Lambda memory and rotate on each deployment.

### 1.2 Current State

**Implemented**:
- `GitHub__API` - Base REST operations (GET/PUT/DELETE)
- `GitHub__Secrets` - Complete secrets management (repo, org, environment)
- `Service__Auth` - Token creation, validation, encryption/decryption
- `Service__Encryption` - General-purpose NaCl encryption service
- Auth routes (`/auth/*`) and Encryption routes (`/encryption/*`)

**To Implement**:
- GitHub Secrets routes exposing `GitHub__Secrets` via REST
- GitHub Actions service layer and routes (Workflows, Runs, Artifacts)
- GitHub Repos service layer and routes
- Unified request/response schema pattern
- Shared PAT injection dependency

### 1.3 Key Architectural Principle

**No GET requests**. All operations use POST/PUT/DELETE with request body containing the encrypted PAT. This enables:
- Consistent request schema pattern across all operations
- Encrypted PAT in request body (debuggable, loggable, safe)
- Request validation via Type_Safe schemas

---

## 2. Architecture Decisions & Rationale

### 2.1 Encrypted PAT in Request Body (Not Header)

**Decision**: Move encrypted PAT from `X-OSBot-GitHub-PAT` header to request body.

**Rationale**:
- The encrypted PAT is an opaque token—meaningless without the private key
- Private key exists only in Lambda memory, rotates on deployment
- Safe to log, include in error reports, store in request history
- Enables consistent `Schema__GitHub__Request__Base` pattern
- Eliminates GET requests (which cannot have request bodies)
- Request schemas become self-documenting and validatable

**Security Note**: The encrypted PAT provides zero information to an attacker without the private key, which is:
1. Never persisted to disk
2. Only in Lambda environment variables
3. Rotated on every deployment
4. Generated fresh by `NaCl__Key_Management.generate_nacl_keys()`

### 2.2 POST for All Operations

**Decision**: Use POST for all operations (list, get, create, update). Use PUT for updates where idempotency matters. Use DELETE for removals.

**Rationale**:
- REST purity is secondary to consistency and security
- All operations require encrypted PAT in request body
- GET requests cannot carry request bodies reliably
- This service is a proxy, not a direct REST API

**HTTP Method Mapping**:
| Operation Type | HTTP Method |
|----------------|-------------|
| List resources | POST |
| Get single resource | POST |
| Create resource | POST |
| Update resource | PUT |
| Delete resource | DELETE |

### 2.3 Unified Response Schema Pattern

**Decision**: All responses follow `Schema__GitHub__Response` with `response_context` and `response_data` fields.

**Rationale**:
- Consistent structure across all endpoints
- `response_context` contains execution metadata (duration, errors, rate limits)
- `response_data` contains operation-specific payload
- On failure, `response_data` contains partial results (whatever was collected before failure)
- HTTP status code reflects operation outcome

### 2.4 Type_Safe Everything

**Decision**: All inputs and outputs use Type_Safe classes with Safe_* primitives.

**Rationale**:
- Runtime type validation
- Injection attack prevention
- Self-documenting code
- FastAPI integration (automatic OpenAPI schema generation)
- Consistent validation patterns

### 2.5 Encrypted Secret Values

**Decision**: Secret values submitted to create/update endpoints must be encrypted using the server's public key.

**Rationale**:
- Defense in depth—even if TLS is compromised, secret values are encrypted
- Consistent with PAT encryption pattern
- Server decrypts value, then re-encrypts for GitHub using GitHub's public key
- Client retrieves server's public key via `/encryption/public-key`

---

## 3. Schema Architecture

### 3.1 Base Schemas (Reusable Across All Routes)

```
Schema__Response__Context
├── success      : bool                     # Overall operation success
├── status_code  : Enum__HTTP__Status       # HTTP status code enum
├── duration     : float                    # Seconds (via capture_duration())
├── timestamp    : Timestamp_Now            # Auto-populated
├── messages     : List[Safe_Str__Text]     # Informational messages
├── errors       : List[Safe_Str__Text]     # Error details
└── error_type   : Enum__Error__Type        # Error classification

Schema__Response__Data                      # Empty Type_Safe base class

Schema__Request__Data                       # Empty Type_Safe base class
```

### 3.2 GitHub-Specific Context

```
Schema__GitHub__Response__Context(Schema__Response__Context)
└── rate_limit   : Schema__GitHub__Rate_Limit

Schema__GitHub__Rate_Limit
├── limit        : Safe__UInt               # Rate limit ceiling
├── remaining    : Safe__UInt               # Remaining requests
├── reset        : Safe__UInt               # Unix timestamp for reset
└── used         : Safe__UInt               # Requests used
```

### 3.3 GitHub Request Base

```
Schema__GitHub__Request__Base
├── encrypted_pat : Safe_Str__Encrypted_Value   # NaCl-encrypted GitHub PAT
└── request_data  : Schema__Request__Data       # Operation-specific (base)
```

### 3.4 GitHub Response Base

```
Schema__GitHub__Response
├── response_context : Schema__GitHub__Response__Context
└── response_data    : Schema__Response__Data   # Operation-specific (base)
```

### 3.5 Operation-Specific Schemas (Examples)

**Secrets List**:
```
Schema__GitHub__Request__Secrets__List(Schema__GitHub__Request__Base)
└── request_data : Schema__GitHub__Data__Request__Secrets__List
    ├── owner    : Safe_Str__GitHub__Owner
    └── repo     : Safe_Str__GitHub__Repo

Schema__GitHub__Response__Secrets__List(Schema__GitHub__Response)
└── response_data : Schema__GitHub__Data__Secrets__List
    └── secrets   : List[Schema__GitHub__Secret__Metadata]

Schema__GitHub__Secret__Metadata
├── name       : Safe_Str__GitHub__Secret__Name
├── created_at : Safe_Str__Timestamp            # ISO format from GitHub
└── updated_at : Safe_Str__Timestamp
```

**Secret Create/Update**:
```
Schema__GitHub__Request__Secret__Create(Schema__GitHub__Request__Base)
└── request_data : Schema__GitHub__Data__Request__Secret__Create
    ├── owner           : Safe_Str__GitHub__Owner
    ├── repo            : Safe_Str__GitHub__Repo
    ├── name            : Safe_Str__GitHub__Secret__Name
    └── encrypted_value : Safe_Str__Encrypted_Value  # Secret value, encrypted

Schema__GitHub__Response__Secret__Create(Schema__GitHub__Response)
└── response_data : Schema__GitHub__Data__Secret__Create
    └── created : bool
```

### 3.6 Enum Definitions

**Enum__HTTP__Status**:
```
OK_200              = 200
CREATED_201         = 201
NO_CONTENT_204      = 204
BAD_REQUEST_400     = 400
UNAUTHORIZED_401    = 401
FORBIDDEN_403       = 403
NOT_FOUND_404       = 404
RATE_LIMITED_429    = 429
SERVER_ERROR_500    = 500
```

**Enum__Error__Type**:
```
NONE                = "none"
INVALID_INPUT       = "invalid_input"
MISSING_FIELD       = "missing_field"
DECRYPTION_FAILED   = "decryption_failed"
INVALID_PAT         = "invalid_pat"
PAT_EXPIRED         = "pat_expired"
INSUFFICIENT_SCOPES = "insufficient_scopes"
NOT_FOUND           = "not_found"
RATE_LIMITED        = "rate_limited"
FORBIDDEN           = "forbidden"
GITHUB_API_ERROR    = "github_api_error"
SERVER_ERROR        = "server_error"
```

---

## 4. Route Architecture

### 4.1 Route Hierarchy

```
Service__Fast_API
├── Routes__Auth                        (existing)
├── Routes__Encryption                  (existing)
├── Routes__Info                        (existing)
├── Routes__GitHub__Secrets__Repo       (new)
├── Routes__GitHub__Secrets__Org        (new)
├── Routes__GitHub__Secrets__Env        (new)
├── Routes__GitHub__Actions__Workflows  (new)
├── Routes__GitHub__Actions__Runs       (new)
├── Routes__GitHub__Actions__Artifacts  (new)
└── Routes__GitHub__Repos               (new)
```

### 4.2 REST Endpoints

#### Secrets - Repository

| Method | Path | Operation | Request Schema | Response Schema |
|--------|------|-----------|----------------|-----------------|
| POST | `/github/secrets/repo/list` | List secrets | `Schema__GitHub__Request__Secrets__List` | `Schema__GitHub__Response__Secrets__List` |
| POST | `/github/secrets/repo/get` | Get secret metadata | `Schema__GitHub__Request__Secret__Get` | `Schema__GitHub__Response__Secret__Get` |
| POST | `/github/secrets/repo/create` | Create secret | `Schema__GitHub__Request__Secret__Create` | `Schema__GitHub__Response__Secret__Create` |
| PUT | `/github/secrets/repo/update` | Update secret | `Schema__GitHub__Request__Secret__Update` | `Schema__GitHub__Response__Secret__Update` |
| DELETE | `/github/secrets/repo/delete` | Delete secret | `Schema__GitHub__Request__Secret__Delete` | `Schema__GitHub__Response__Secret__Delete` |

#### Secrets - Organization

| Method | Path | Operation |
|--------|------|-----------|
| POST | `/github/secrets/org/list` | List org secrets |
| POST | `/github/secrets/org/get` | Get org secret metadata |
| POST | `/github/secrets/org/create` | Create org secret |
| PUT | `/github/secrets/org/update` | Update org secret |
| DELETE | `/github/secrets/org/delete` | Delete org secret |

#### Secrets - Environment

| Method | Path | Operation |
|--------|------|-----------|
| POST | `/github/secrets/env/list` | List environment secrets |
| POST | `/github/secrets/env/get` | Get environment secret metadata |
| POST | `/github/secrets/env/create` | Create environment secret |
| PUT | `/github/secrets/env/update` | Update environment secret |
| DELETE | `/github/secrets/env/delete` | Delete environment secret |

#### Actions - Workflows

| Method | Path | Operation |
|--------|------|-----------|
| POST | `/github/actions/workflows/list` | List workflows |
| POST | `/github/actions/workflows/get` | Get workflow details |
| POST | `/github/actions/workflows/dispatch` | Trigger workflow run |
| POST | `/github/actions/workflows/enable` | Enable workflow |
| POST | `/github/actions/workflows/disable` | Disable workflow |

#### Actions - Runs

| Method | Path | Operation |
|--------|------|-----------|
| POST | `/github/actions/runs/list` | List workflow runs |
| POST | `/github/actions/runs/get` | Get run details |
| POST | `/github/actions/runs/cancel` | Cancel run |
| POST | `/github/actions/runs/rerun` | Re-run workflow |
| POST | `/github/actions/runs/rerun-failed` | Re-run failed jobs |
| POST | `/github/actions/runs/logs` | Get run logs URL |
| DELETE | `/github/actions/runs/delete` | Delete run |

#### Actions - Artifacts

| Method | Path | Operation |
|--------|------|-----------|
| POST | `/github/actions/artifacts/list` | List artifacts |
| POST | `/github/actions/artifacts/get` | Get artifact details |
| POST | `/github/actions/artifacts/download` | Get download URL |
| DELETE | `/github/actions/artifacts/delete` | Delete artifact |

#### Repos

| Method | Path | Operation |
|--------|------|-----------|
| POST | `/github/repos/get` | Get repository info |
| POST | `/github/repos/branches/list` | List branches |
| POST | `/github/repos/branches/get` | Get branch details |
| POST | `/github/repos/tags/list` | List tags |
| POST | `/github/repos/releases/list` | List releases |
| POST | `/github/repos/releases/get` | Get release details |
| POST | `/github/repos/releases/create` | Create release |

---

## 5. Service Layer Architecture

### 5.1 Service Hierarchy

```
GitHub__API                         (existing) - Base REST operations
├── GitHub__Secrets                 (existing) - Secrets management
├── GitHub__Actions__Workflows      (new)      - Workflow operations
├── GitHub__Actions__Runs           (new)      - Run operations
├── GitHub__Actions__Artifacts      (new)      - Artifact operations
└── GitHub__Repos                   (new)      - Repository operations
```

### 5.2 Shared Dependency: GitHub__API__From__Header

This dependency extracts and decrypts the PAT from the request, returning a configured `GitHub__API` instance.

**Location**: `mgraph_ai_service_github/fast_api/dependencies/GitHub__API__From__Header.py`

**Implementation Pattern**:
```python
class GitHub__API__From__Header(Type_Safe):
    service_auth : Service__Auth
    
    def get_api(self, encrypted_pat: Safe_Str__Encrypted_Value) -> GitHub__API:
        """Decrypt PAT and return configured GitHub__API instance."""
        decrypted_pat = self.service_auth.decrypt_pat(encrypted_pat)
        return GitHub__API(api_token=decrypted_pat)
```

**Usage in Routes**:
```python
class Routes__GitHub__Secrets__Repo(Fast_API__Routes):
    github_api_factory : GitHub__API__From__Header
    
    def list(self, request: Schema__GitHub__Request__Secrets__List
             ) -> Schema__GitHub__Response__Secrets__List:
        
        with capture_duration() as duration:
            response_context = Schema__GitHub__Response__Context()
            response_data    = Schema__GitHub__Data__Secrets__List()
            
            try:
                github_api = self.github_api_factory.get_api(request.encrypted_pat)
                # ... operation logic
            except Exception as e:
                # ... error handling
            finally:
                response_context.duration = duration.seconds
        
        return Schema__GitHub__Response__Secrets__List(
            response_context = response_context,
            response_data    = response_data
        )
```

### 5.3 New Service Classes

**GitHub__Actions__Workflows**:
```python
class GitHub__Actions__Workflows(Type_Safe):
    api : GitHub__API
    
    def list(self, owner: str, repo: str, page: int = 1, per_page: int = 30) -> Dict
    def get(self, owner: str, repo: str, workflow_id: int) -> Dict
    def dispatch(self, owner: str, repo: str, workflow_id: int, ref: str, inputs: Dict = None) -> bool
    def enable(self, owner: str, repo: str, workflow_id: int) -> bool
    def disable(self, owner: str, repo: str, workflow_id: int) -> bool
```

**GitHub__Actions__Runs**:
```python
class GitHub__Actions__Runs(Type_Safe):
    api : GitHub__API
    
    def list(self, owner: str, repo: str, page: int = 1, per_page: int = 30) -> Dict
    def get(self, owner: str, repo: str, run_id: int) -> Dict
    def cancel(self, owner: str, repo: str, run_id: int) -> bool
    def rerun(self, owner: str, repo: str, run_id: int) -> bool
    def rerun_failed_jobs(self, owner: str, repo: str, run_id: int) -> bool
    def get_logs_url(self, owner: str, repo: str, run_id: int) -> str
    def delete(self, owner: str, repo: str, run_id: int) -> bool
```

**GitHub__Actions__Artifacts**:
```python
class GitHub__Actions__Artifacts(Type_Safe):
    api : GitHub__API
    
    def list(self, owner: str, repo: str, page: int = 1, per_page: int = 30) -> Dict
    def get(self, owner: str, repo: str, artifact_id: int) -> Dict
    def get_download_url(self, owner: str, repo: str, artifact_id: int) -> str
    def delete(self, owner: str, repo: str, artifact_id: int) -> bool
```

**GitHub__Repos**:
```python
class GitHub__Repos(Type_Safe):
    api : GitHub__API
    
    def get(self, owner: str, repo: str) -> Dict
    def list_branches(self, owner: str, repo: str, page: int = 1, per_page: int = 30) -> Dict
    def get_branch(self, owner: str, repo: str, branch: str) -> Dict
    def list_tags(self, owner: str, repo: str, page: int = 1, per_page: int = 30) -> Dict
    def list_releases(self, owner: str, repo: str, page: int = 1, per_page: int = 30) -> Dict
    def get_release(self, owner: str, repo: str, release_id: int) -> Dict
    def create_release(self, owner: str, repo: str, tag_name: str, name: str = None, body: str = None, draft: bool = False, prerelease: bool = False) -> Dict
```

---

## 6. Implementation Patterns

### 6.1 Route Method Pattern

Every route method follows this structure:

```python
def operation_name(self, request: Schema__GitHub__Request__*
                   ) -> Schema__GitHub__Response__*:
    
    with capture_duration() as duration:
        # Initialize response objects (populated incrementally)
        response_context = Schema__GitHub__Response__Context(
            success    = False,
            status_code = Enum__HTTP__Status.SERVER_ERROR_500,
            messages   = [],
            errors     = [],
            error_type = Enum__Error__Type.NONE
        )
        response_data = Schema__GitHub__Data__*()  # Operation-specific
        
        try:
            # 1. Get GitHub API instance
            github_api = self.github_api_factory.get_api(request.encrypted_pat)
            
            # 2. Execute operation (populate response_data incrementally)
            result = github_api.get('/some/endpoint')
            response_data.some_field = result.get('field')
            
            # 3. Capture rate limit info
            rate_limit = github_api.get('/rate_limit')
            response_context.rate_limit = Schema__GitHub__Rate_Limit(
                limit     = Safe__UInt(rate_limit['rate']['limit']),
                remaining = Safe__UInt(rate_limit['rate']['remaining']),
                reset     = Safe__UInt(rate_limit['rate']['reset']),
                used      = Safe__UInt(rate_limit['rate']['used'])
            )
            
            # 4. Mark success
            response_context.success     = True
            response_context.status_code = Enum__HTTP__Status.OK_200
            
        except DecryptionError as e:
            response_context.status_code = Enum__HTTP__Status.UNAUTHORIZED_401
            response_context.error_type  = Enum__Error__Type.DECRYPTION_FAILED
            response_context.errors.append(Safe_Str__Text(str(e)))
            
        except GitHubAPIError as e:
            # Map GitHub errors to appropriate status codes
            response_context.status_code = self._map_github_error(e)
            response_context.error_type  = self._classify_error(e)
            response_context.errors.append(Safe_Str__Text(str(e)))
            
        except Exception as e:
            response_context.errors.append(Safe_Str__Text(f"Unexpected error: {e}"))
        
        finally:
            response_context.duration = duration.seconds
    
    return Schema__GitHub__Response__*(
        response_context = response_context,
        response_data    = response_data  # Contains partial results on failure
    )
```

### 6.2 Error Mapping

```python
def _map_github_error(self, error: Exception) -> Enum__HTTP__Status:
    error_str = str(error)
    if "401" in error_str:
        return Enum__HTTP__Status.UNAUTHORIZED_401
    elif "403" in error_str and "rate limit" in error_str.lower():
        return Enum__HTTP__Status.RATE_LIMITED_429
    elif "403" in error_str:
        return Enum__HTTP__Status.FORBIDDEN_403
    elif "404" in error_str:
        return Enum__HTTP__Status.NOT_FOUND_404
    else:
        return Enum__HTTP__Status.SERVER_ERROR_500

def _classify_error(self, error: Exception) -> Enum__Error__Type:
    error_str = str(error)
    if "401" in error_str:
        return Enum__Error__Type.INVALID_PAT
    elif "403" in error_str and "rate limit" in error_str.lower():
        return Enum__Error__Type.RATE_LIMITED
    elif "403" in error_str:
        return Enum__Error__Type.FORBIDDEN
    elif "404" in error_str:
        return Enum__Error__Type.NOT_FOUND
    else:
        return Enum__Error__Type.GITHUB_API_ERROR
```

### 6.3 Route Registration Pattern

```python
class Routes__GitHub__Secrets__Repo(Fast_API__Routes):
    tag                 : str                       = 'github-secrets-repo'
    github_api_factory  : GitHub__API__From__Header
    
    def setup_routes(self):
        self.add_route_post  (self.list  )
        self.add_route_post  (self.get   )
        self.add_route_post  (self.create)
        self.add_route_put   (self.update)
        self.add_route_delete(self.delete)
```

### 6.4 FastAPI Response Status Code

To ensure HTTP status code matches the operation outcome, use FastAPI's `Response` parameter:

```python
from fastapi import Response

def list(self, request: Schema__GitHub__Request__Secrets__List,
         response: Response
         ) -> Schema__GitHub__Response__Secrets__List:
    
    # ... operation logic ...
    
    response.status_code = response_context.status_code.value
    return Schema__GitHub__Response__Secrets__List(...)
```

---

## 7. Safe_Str Classes Required

### 7.1 Existing (in osbot_utils or service)

- `Safe_Str__Encrypted_Value` - Base64-encoded NaCl encrypted data
- `Safe_Str__Decrypted_Value` - Decrypted value
- `Safe_Str__NaCl__Public_Key` - 64-char hex public key
- `Safe_Str__NaCl__Private_Key` - 64-char hex private key
- `Safe_Str__Text` - General text
- `Safe_Str__Version` - Version strings
- `Safe__UInt` - Unsigned integers
- `Timestamp_Now` - Auto-populated timestamp

### 7.2 GitHub-Specific (to create/verify)

- `Safe_Str__GitHub__Owner` - GitHub username/org (alphanumeric, hyphens, max 39 chars)
- `Safe_Str__GitHub__Repo` - Repository name (alphanumeric, hyphens, underscores, dots)
- `Safe_Str__GitHub__Branch` - Branch name
- `Safe_Str__GitHub__Tag` - Tag name
- `Safe_Str__GitHub__SHA` - Git SHA (40 hex chars)
- `Safe_Str__GitHub__Secret__Name` - Secret name (alphanumeric, underscores)
- `Safe_Str__GitHub__Environment` - Environment name
- `Safe_Str__GitHub__Workflow__ID` - Workflow ID (numeric or filename)

---

## 8. File Structure

```
mgraph_ai_service_github/
├── config.py                               (existing)
├── fast_api/
│   ├── Service__Fast_API.py                (modify - add new routes)
│   ├── dependencies/
│   │   └── GitHub__API__From__Header.py    (new)
│   └── routes/
│       ├── Routes__Auth.py                 (existing)
│       ├── Routes__Encryption.py           (existing)
│       ├── Routes__Info.py                 (existing)
│       ├── Routes__GitHub__Secrets__Repo.py    (new)
│       ├── Routes__GitHub__Secrets__Org.py     (new)
│       ├── Routes__GitHub__Secrets__Env.py     (new)
│       ├── Routes__GitHub__Actions__Workflows.py (new)
│       ├── Routes__GitHub__Actions__Runs.py    (new)
│       ├── Routes__GitHub__Actions__Artifacts.py (new)
│       └── Routes__GitHub__Repos.py            (new)
├── schemas/
│   ├── base/
│   │   ├── Schema__Response__Context.py        (new)
│   │   ├── Schema__Response__Data.py           (new)
│   │   ├── Schema__Request__Data.py            (new)
│   │   ├── Enum__HTTP__Status.py               (new)
│   │   └── Enum__Error__Type.py                (new)
│   ├── github/
│   │   ├── base/
│   │   │   ├── Schema__GitHub__Response__Context.py (new)
│   │   │   ├── Schema__GitHub__Response.py          (new)
│   │   │   ├── Schema__GitHub__Request__Base.py     (new)
│   │   │   └── Schema__GitHub__Rate_Limit.py        (new)
│   │   ├── secrets/
│   │   │   ├── Schema__GitHub__Request__Secrets__List.py    (new)
│   │   │   ├── Schema__GitHub__Response__Secrets__List.py   (new)
│   │   │   ├── Schema__GitHub__Request__Secret__Get.py      (new)
│   │   │   ├── Schema__GitHub__Response__Secret__Get.py     (new)
│   │   │   ├── Schema__GitHub__Request__Secret__Create.py   (new)
│   │   │   ├── Schema__GitHub__Response__Secret__Create.py  (new)
│   │   │   ├── Schema__GitHub__Data__Secrets__List.py       (new)
│   │   │   ├── Schema__GitHub__Data__Secret__Metadata.py    (new)
│   │   │   └── Schema__GitHub__Secret__Metadata.py          (new)
│   │   ├── actions/
│   │   │   ├── workflows/                       (new - similar pattern)
│   │   │   ├── runs/                            (new - similar pattern)
│   │   │   └── artifacts/                       (new - similar pattern)
│   │   └── repos/                               (new - similar pattern)
│   └── encryption/                         (existing)
├── service/
│   ├── auth/                               (existing)
│   ├── encryption/                         (existing)
│   ├── github/
│   │   ├── GitHub__API.py                  (existing)
│   │   ├── GitHub__Secrets.py              (existing)
│   │   ├── GitHub__Actions__Workflows.py   (new)
│   │   ├── GitHub__Actions__Runs.py        (new)
│   │   ├── GitHub__Actions__Artifacts.py   (new)
│   │   └── GitHub__Repos.py                (new)
│   └── info/                               (existing)
└── utils/                                  (existing)
```

---

## 9. Implementation Order

### Phase 1: Foundation (Priority)

1. **Base Schemas**
   - `Schema__Response__Context`
   - `Schema__Response__Data`
   - `Schema__Request__Data`
   - `Enum__HTTP__Status`
   - `Enum__Error__Type`

2. **GitHub Base Schemas**
   - `Schema__GitHub__Rate_Limit`
   - `Schema__GitHub__Response__Context`
   - `Schema__GitHub__Response`
   - `Schema__GitHub__Request__Base`

3. **PAT Injection Dependency**
   - `GitHub__API__From__Header`

### Phase 2: Secrets (Uses Existing Service)

4. **Secrets Schemas**
   - Request/Response/Data schemas for all secrets operations

5. **Secrets Routes**
   - `Routes__GitHub__Secrets__Repo`
   - `Routes__GitHub__Secrets__Org`
   - `Routes__GitHub__Secrets__Env`

### Phase 3: Actions (New Service Layer)

6. **Actions Service Classes**
   - `GitHub__Actions__Workflows`
   - `GitHub__Actions__Runs`
   - `GitHub__Actions__Artifacts`

7. **Actions Schemas**
   - Request/Response/Data schemas for all actions operations

8. **Actions Routes**
   - `Routes__GitHub__Actions__Workflows`
   - `Routes__GitHub__Actions__Runs`
   - `Routes__GitHub__Actions__Artifacts`

### Phase 4: Repos (New Service Layer)

9. **Repos Service Class**
   - `GitHub__Repos`

10. **Repos Schemas**
    - Request/Response/Data schemas for all repos operations

11. **Repos Routes**
    - `Routes__GitHub__Repos`

### Phase 5: Integration

12. **Update Service__Fast_API**
    - Register all new routes

13. **Testing**
    - Unit tests for each service class
    - Integration tests for each route
    - End-to-end tests with real GitHub PATs

---

## 10. Testing Strategy

### 10.1 Unit Tests

Each service class should have comprehensive unit tests mocking `GitHub__API`:

```python
class test_GitHub__Actions__Workflows(TestCase):
    
    def test_list_workflows(self):
        # Mock GitHub__API.get()
        # Verify correct endpoint called
        # Verify response parsing
        
    def test_dispatch_workflow(self):
        # Mock GitHub__API.post()
        # Verify correct payload
        # Verify success/failure handling
```

### 10.2 Route Tests

Test request schema validation, response structure, and error handling:

```python
class test_Routes__GitHub__Secrets__Repo(TestCase):
    
    def test_list_returns_correct_schema(self):
        # Valid request → verify response_context and response_data structure
        
    def test_invalid_pat_returns_401(self):
        # Invalid encrypted PAT → verify UNAUTHORIZED_401
        
    def test_partial_results_on_failure(self):
        # Operation fails mid-way → verify response_data contains partial results
```

### 10.3 Integration Tests

End-to-end tests with real (test) GitHub PATs:

```python
class test_Integration__GitHub__Secrets(TestCase):
    
    def test_full_secret_lifecycle(self):
        # Create → Get → Update → Delete
        # Verify each operation succeeds
        # Verify rate_limit info populated
```

---

## 11. Reference Documentation

### 11.1 Existing Codebase Files

- `mgraph_ai_service_github/service/github/GitHub__API.py` - Base API pattern
- `mgraph_ai_service_github/service/github/GitHub__Secrets.py` - Secrets implementation
- `mgraph_ai_service_github/service/auth/Service__Auth.py` - PAT encryption/decryption
- `mgraph_ai_service_github/fast_api/routes/Routes__Auth.py` - Route pattern example
- `mgraph_ai_service_github/schemas/encryption/*` - Schema patterns

### 11.2 External References

- [v3_1_1__osbot-utils__type-safe__and__python-formatting__guidance.md](uploaded) - Type_Safe patterns
- [v3_28_0__osbot-utils-safe-primitives__reference-guide.md](uploaded) - Safe_* primitives reference
- [v0_24_2__osbot-fast-api__routes_development_guide.md](uploaded) - FastAPI routes development
- [v0_6_2__service-architecture-summary-and-learnings.md](uploaded) - Architecture decisions history

### 11.3 GitHub API Documentation

- [Secrets API](https://docs.github.com/en/rest/actions/secrets)
- [Workflows API](https://docs.github.com/en/rest/actions/workflows)
- [Workflow Runs API](https://docs.github.com/en/rest/actions/workflow-runs)
- [Artifacts API](https://docs.github.com/en/rest/actions/artifacts)
- [Repositories API](https://docs.github.com/en/rest/repos/repos)
- [Releases API](https://docs.github.com/en/rest/releases/releases)

---

## 12. Code Style Guidelines

### 12.1 Formatting (Per osbot-utils conventions)

- Align equals signs, colons, and comments in visual columns
- Use explicit type annotations on all attributes
- Group related imports with blank lines
- Method docstrings use inline comments (# comment) not triple-quotes

### 12.2 Naming Conventions

- Classes: `PascalCase` with `__` separating logical groups (e.g., `Schema__GitHub__Response__Secrets__List`)
- Methods: `snake_case`
- Constants: `UPPER_SNAKE_CASE`
- Route tags: `kebab-case` (e.g., `'github-secrets-repo'`)

### 12.3 Type_Safe Usage

- All class attributes must have type annotations
- Use Safe_* primitives for all user-provided data
- Use Enum types for all fixed-value fields
- Use Type_Safe base class for all schemas

---

## 13. Success Criteria

Implementation is complete when:

1. ✅ All schemas defined with Type_Safe classes
2. ✅ All routes registered and returning correct response schemas
3. ✅ HTTP status codes match operation outcomes
4. ✅ Rate limit info populated on all GitHub responses
5. ✅ Partial results returned on operation failure
6. ✅ Encrypted PAT in request body (no GET requests)
7. ✅ Encrypted secret values for create/update operations
8. ✅ Unit tests passing for all service classes
9. ✅ Integration tests passing with test GitHub PATs
10. ✅ OpenAPI documentation auto-generated correctly

---

*Document Version: v0.7.0*
*Created: December 2025*
*Target Release: MGraph-AI Service GitHub v0.7.0*